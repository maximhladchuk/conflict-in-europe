// Language translations
const translations = {
  uk: {
    nav: {
      servers: "Сервери",
      support: "Підтримка",
      rules: "Правила",
      community: "Спільнота"
    },
    hero: {
      eyebrow: "ARMA Reforger",
      title: "Conflict in Europe — Провідні Сервери",
      subtitle: "Приєднуйтесь, воюйте та завойовуйте поле бою з гравцями з усього світу.",
      join_discord: "ПРИЄДНАТИСЯ ДО DISCORD",
      play_now: "ГРАТИ ЗАРАЗ",
      hero_image_alt: "Поле бою ARMA Reforger",
      platforms: {
        steam: "Steam",
        xbox: "Xbox",
        playstation: "PlayStation"
      }
    },
    servers: {
      title: "Наші Сервери",
      online: "Онлайн",
      offline: "Офлайн",
      players: "Гравці",
      region: "Регіон",
      loading: "Завантаження серверів...",
      error: "Помилка завантаження серверів",
      connection_error: "Помилка З'єднання",
      join_now: "ПРИЄДНАТИСЯ"
    },
    support: {
      title: "Підтримайте Нас",
      go_to_patreon: "ПЕРЕЙТИ НА PATREON",
      go_to_paypal: "ПЕРЕЙТИ НА PAYPAL",
      copy_wallet: "КОПІЮВАТИ ГАМАНЕЦЬ",
      copy_card: "КОПІЮВАТИ НОМЕР КАРТКИ",
      get_qr: "ОТРИМАТИ QR КОД",
      qr_modal_title: "QR Код",
      close_modal: "Закрити",
      qr_patreon_alt: "QR код для Patreon",
      qr_paypal_alt: "QR код для PayPal",
      qr_usdt_alt: "QR код для USDT",
      qr_privat24_alt: "QR код для Privat24"
    },
    rules: {
      title: "Правила",
      forbidden: "Заборонено:",
      discord: {
        title: "I. Правила Discord",
        "1_1": "1.1 Приниження честі та гідності інших учасників сервера будь-яким способом",
        "1_2": "1.2 Згадування близьких родичів у негативному контексті",
        "1_3": "1.3 Розповсюдження сторонніх ресурсів і серверів у нашому Discord або в грі",
        "1_4": "1.4 Обговорення або згадування реальних війн, конфліктів або подій, які можуть викликати напругу в спільноті серверів",
        "1_5": "1.5 Політичні сутички",
        "1_6": "1.6 Відтворення музики або сторонніх звуків у голосових каналах (Soundpad)",
        "1_7": "1.7 Використання програм для зміни голосу",
        "1_8": "1.8 Засудження дій адміністрації сервера в загальних каналах сервера (дозволено у відповідному каналі: апеляція-бан)",
        "1_9": "1.9 Введення в оману адміністрації проекту",
        "1_10": "1.10 Робити дописи в скарзі до якої не маєш жодного відношення, крім випадків наявності додаткових доказів порушення або виправлення порушника"
      },
      game: {
        title: "II. Правила ігрового сервера",
        "2_1": "2.1 Використання будь-яких сторонніх програм, які дають перевагу в грі",
        "2_2": "2.2 Згадування близьких родичів гравця в негативному контексті",
        "2_3": "2.3 Перетин червоної лінії в бік мейну ворога",
        "2_4": "2.4 Навмисне заважання грі інших гравців у будь-який спосіб",
        "2_4_1": "2.4-1 Заборонено використовувати артилерію, реактивні системи залпового вогню (РСЗВ), міномети та командно-штабні машини, не перетнувши червону лінію",
        "2_5": "2.5 Використання помилок, які дають вам перевагу над іншими гравцями",
        "2_6": "2.6 Перехід на особисті образи в загальному чаті, не пов'язані із зануренням у гру. Особисті образи дозволені лише в голосовому чаті проти ворогів",
        "2_7": "2.7 Забороняється участь у політичних дискусіях у грі та згадування подій реальної війни",
        "2_8": "2.8 Будь-які образи адміністрації де б це не було"
      }
    },
    community: {
      title: "Спільнота",
      discord_text: "Приєднуйтесь до нашого Discord для отримання доступу до вайтлістів, подій, розкладу операцій та підтримки.",
      open_discord: "ВІДКРИТИ DISCORD",
      follow_text: "Стежте за нами на платформах для новин та оновлень.",
      steam: "Група Steam",
      twitter: "Twitter/X",
      youtube: "YouTube"
    },
    footer: {
      copyright: "Conflict in Europe — Неофіційна спільнота ARMA Reforger"
    },
    theme: {
      toggle: "Перемкнути тему"
    },
    toast: {
      copied: "Скопійовано!"
    }
  },
  en: {
    nav: {
      servers: "Servers",
      support: "Support Us",
      rules: "Rules",
      community: "Community"
    },
    hero: {
      eyebrow: "ARMA Reforger",
      title: "Conflict in Europe — Premier Servers",
      subtitle: "Join, fight, and conquer the battlefield with players worldwide.",
      join_discord: "JOIN DISCORD",
      play_now: "PLAY NOW",
      hero_image_alt: "ARMA Reforger battlefield scene",
      platforms: {
        steam: "Steam",
        xbox: "Xbox",
        playstation: "PlayStation"
      }
    },
    servers: {
      title: "Our Servers",
      online: "Online",
      offline: "Offline",
      players: "Players",
      region: "Region",
      loading: "Loading servers...",
      join_now: "JOIN NOW"
    },
    support: {
      title: "Support Us",
      go_to_patreon: "GO TO PATREON",
      go_to_paypal: "GO TO PAYPAL",
      copy_wallet: "COPY WALLET",
      copy_card: "COPY CARD NUMBER",
      get_qr: "GET QR CODE",
      qr_modal_title: "QR Code",
      close_modal: "Close",
      qr_patreon_alt: "QR code for Patreon",
      qr_paypal_alt: "QR code for PayPal",
      qr_usdt_alt: "QR code for USDT",
      qr_privat24_alt: "QR code for Privat24"
    },
    rules: {
      title: "Rules",
      forbidden: "Forbidden:",
      discord: {
        title: "I. Discord Rules",
        "1_1": "1.1 Degrading the honor and dignity of other server participants in any way",
        "1_2": "1.2 Mentioning close relatives in a negative context",
        "1_3": "1.3 Distribution of third-party resources and servers in our Discord or in the game",
        "1_4": "1.4 Discussing or mentioning real-life wars, conflicts, or events that may cause tension within the server community",
        "1_5": "1.5 Political clashes",
        "1_6": "1.6 Playing music or extraneous sounds in voice channels",
        "1_7": "1.7 Using programs to change your voice",
        "1_8": "1.8 Condemning the actions of the server administration in the general channels (allowed in the appropriate channel: appealing-a-ban)",
        "1_9": "1.9 Misleading the project administration",
        "1_10": "1.10 Make comments in a complaint to which you have no direct relation, except in cases where you provide additional evidence of the violation or corrections of the offender"
      },
      game: {
        title: "II. Game Server Rules",
        "2_1": "2.1 Using any third-party programs that give an advantage in the game",
        "2_2": "2.2 Mentioning close relatives of the player in a negative context",
        "2_3": "2.3 Do not cross the red line near the enemy's main base",
        "2_4": "2.4 Deliberately disrupting the game of other players in any way",
        "2_4_1": "2.4-1 The use of artillery, multiple launch rocket systems (MLRS), mortars, and command staff vehicles is prohibited unless the red line has been crossed",
        "2_5": "2.5 Using bugs that give you an advantage over other players",
        "2_6": "2.6 Transitioning to personal insults in the general chat that are not related to immersion in the game. Personal insults are only allowed in the voice chat against enemies",
        "2_7": "2.7 Engaging in political discussions in the game and mentioning real-world war events is prohibited",
        "2_8": "2.8 Any insults to the administration wherever it may be"
      }
    },
    community: {
      title: "Community",
      discord_text: "Join our Discord to get whitelists, events, ops schedule, and support.",
      open_discord: "OPEN DISCORD",
      follow_text: "Follow us on platforms for news and updates.",
      steam: "Steam Group",
      twitter: "Twitter/X",
      youtube: "YouTube"
    },
    footer: {
      copyright: "Conflict in Europe — Unofficial ARMA Reforger community"
    },
    theme: {
      toggle: "Toggle theme"
    },
    toast: {
      copied: "Copied!"
    },
    servers: {
      title: "Our Servers",
      online: "Online",
      offline: "Offline",
      players: "Players",
      region: "Region",
      loading: "Loading servers...",
      error: "Error loading servers",
      connection_error: "Connection Error",
      join_now: "JOIN NOW"
    }
  }
};

// Get current language from localStorage or default to 'uk'
let currentLang = localStorage.getItem('language') || 'uk';

// Get current theme from localStorage or default to 'light'
let currentTheme = localStorage.getItem('theme') || 'light';

// Function to apply theme
function applyTheme(theme = currentTheme) {
  if (theme === 'dark') {
    document.documentElement.setAttribute('data-theme', 'dark');
  } else {
    document.documentElement.removeAttribute('data-theme');
  }
  
  // Save theme preference
  localStorage.setItem('theme', theme);
  currentTheme = theme;
  
  // Update theme buttons state
  document.querySelectorAll('.theme button').forEach(btn => {
    const isActive = btn.getAttribute('data-theme') === theme;
    btn.setAttribute('aria-pressed', String(isActive));
  });
}

// Function to get nested translation
function getTranslation(key, lang = currentLang) {
  if (!translations || !translations[lang]) {
    return key;
  }
  
  const keys = key.split('.');
  let value = translations[lang];
  
  for (const k of keys) {
    if (value && typeof value === 'object') {
      value = value[k];
    } else {
      return key; // Return key if translation not found
    }
  }
  
  return value || key;
}

// Function to apply translations
function applyTranslations(lang = currentLang) {
  // Translate text content
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const translation = getTranslation(key, lang);
    element.textContent = translation;
  });
  
  // Translate alt attributes
  document.querySelectorAll('[data-i18n-alt]').forEach(element => {
    const key = element.getAttribute('data-i18n-alt');
    const translation = getTranslation(key, lang);
    element.setAttribute('alt', translation);
  });
  
  // Translate title attributes
  document.querySelectorAll('[data-i18n-title]').forEach(element => {
    const key = element.getAttribute('data-i18n-title');
    const translation = getTranslation(key, lang);
    element.setAttribute('title', translation);
  });
  
  // Translate aria-label attributes
  document.querySelectorAll('[data-i18n-aria-label]').forEach(element => {
    const key = element.getAttribute('data-i18n-aria-label');
    const translation = getTranslation(key, lang);
    element.setAttribute('aria-label', translation);
  });
  
  // Update document language
  document.documentElement.lang = lang;
  
  // Save language preference
  localStorage.setItem('language', lang);
  currentLang = lang;
}

// Mobile burger menu
const burger = document.getElementById('burger');
const mobileMenu = document.getElementById('mobileMenu');

if (burger && mobileMenu) {
  burger.addEventListener('click', (e) => {
    e.stopPropagation();
    const open = mobileMenu.classList.toggle('open');
    burger.setAttribute('aria-expanded', String(open));
    burger.setAttribute('aria-label', open ? 'Close menu' : 'Open menu');
    
    // Prevent body scroll when menu is open
    if (open) {
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = '';
    }
  });
  
  // Close mobile menu when clicking outside
  document.addEventListener('click', (e) => {
    if (mobileMenu.classList.contains('open') && 
        !mobileMenu.contains(e.target) && 
        !burger.contains(e.target)) {
      mobileMenu.classList.remove('open');
      burger.setAttribute('aria-expanded', 'false');
      burger.setAttribute('aria-label', 'Open menu');
      document.body.style.overflow = '';
    }
  });
  
  // Close mobile menu on window resize
  window.addEventListener('resize', () => {
    if (window.innerWidth > 768 && mobileMenu.classList.contains('open')) {
      mobileMenu.classList.remove('open');
      burger.setAttribute('aria-expanded', 'false');
      burger.setAttribute('aria-label', 'Open menu');
      document.body.style.overflow = '';
    }
  });
}

// Copy-to-clipboard for support cards
const toast = document.getElementById('toast');
function showToast(msg = 'Copied!') {
  if (!toast) return;
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 1500);
}
function copyText(text) {
  if (!text) return;
  const copiedMsg = getTranslation('toast.copied', currentLang);
  const failMsg = 'Copy failed'; // Keep in English as it's technical
  navigator.clipboard?.writeText(text).then(() => showToast(copiedMsg)).catch(() => showToast(failMsg));
}
document.querySelectorAll('[data-copy]').forEach(btn => {
  btn.addEventListener('click', () => copyText(btn.getAttribute('data-copy')));
});

// Smooth in-page scrolling
document.querySelectorAll('a[href^="#"]').forEach(a => {
  a.addEventListener('click', (e) => {
    const id = a.getAttribute('href');
    if (id.length > 1 && document.querySelector(id)) {
      e.preventDefault();
      document.querySelector(id).scrollIntoView({ behavior: 'smooth', block: 'start' });
      mobileMenu?.classList.remove('open');
      burger?.setAttribute('aria-expanded', 'false');
    }
  });
});

// Language switch
document.querySelectorAll('.lang button').forEach(btn => {
  btn.addEventListener('click', () => {
    const selectedLang = btn.getAttribute('data-lang');
    
    // Update button states
    document.querySelectorAll('.lang button').forEach(b => b.setAttribute('aria-pressed', 'false'));
    btn.setAttribute('aria-pressed', 'true');
    
    // Apply translations
    applyTranslations(selectedLang);
    
    // Re-render servers with new language
    if (serversData.length > 0) {
      renderServers();
    }
  });
});

// Theme toggle
document.querySelectorAll('.theme button').forEach(btn => {
  btn.addEventListener('click', () => {
    const selectedTheme = btn.getAttribute('data-theme');
    applyTheme(selectedTheme);
  });
});

// Initialize language and theme on page load
document.addEventListener('DOMContentLoaded', () => {
  // Set initial button state based on current language
  document.querySelectorAll('.lang button').forEach(btn => {
    const isActive = btn.getAttribute('data-lang') === currentLang;
    btn.setAttribute('aria-pressed', String(isActive));
  });
  
  // Set initial button state based on current theme
  document.querySelectorAll('.theme button').forEach(btn => {
    const isActive = btn.getAttribute('data-theme') === currentTheme;
    btn.setAttribute('aria-pressed', String(isActive));
  });
  
  // Apply initial theme and translations
  applyTheme(currentTheme);
  applyTranslations(currentLang);
  
  // Load servers data
  loadServers();
  
  // Re-render servers after translations are applied
  setTimeout(() => {
    if (serversData.length > 0) {
      renderServers();
    }
  }, 100);
});

// Year in footer
document.getElementById('year').textContent = new Date().getFullYear();

// Server data loading and rendering
let serversData = [];

// Function to load servers from API
async function loadServers() {
  const serverList = document.querySelector('.server-list');
  if (!serverList) return;
  
  // Show loading state
  serverList.innerHTML = `
    <div class="server-loading">
      ${getTranslation('servers.loading', currentLang)}
    </div>
  `;
  
  try {
    // Try direct fetch first
    let response;
    let data;
    
    try {
      response = await fetch('https://conflictineurope.com/servers_info.json', {
        method: 'GET',
        mode: 'cors',
        cache: 'no-cache',
        headers: {
          'Accept': 'application/json',
        }
      });
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      data = await response.json();
    } catch (corsError) {
      console.warn('CORS error, trying proxy method:', corsError);
      
      // Try with a CORS proxy
      const proxyUrl = 'https://api.allorigins.win/get?url=';
      const targetUrl = encodeURIComponent('https://conflictineurope.com/servers_info.json');
      
      response = await fetch(proxyUrl + targetUrl);
      
      if (!response.ok) {
        throw new Error(`Proxy request failed! status: ${response.status}`);
      }
      
      const proxyData = await response.json();
      data = JSON.parse(proxyData.contents);
    }
    
    if (!Array.isArray(data)) {
      throw new Error('Invalid data format');
    }
    
    serversData = data.filter(server => !server.error && server.server_name); // Filter out servers with errors
    console.log('Loaded servers:', serversData.length);
    
    if (serversData.length === 0) {
      throw new Error('No valid servers found');
    }
    
    renderServers();
  } catch (error) {
    console.error('Error loading servers:', error);
    console.error('Error details:', error.message);
    
    // Try to load from backup source or show fallback
    loadFallbackServers();
  }
}

// Function to parse server name and extract features
function parseServerInfo(serverName) {
  const features = [];
  
  if (serverName.includes('1pp/3pp')) {
    features.push('Third-person view');
  } else if (serverName.includes('1pp')) {
    features.push('First-person only, except for vehicles');
  }
  
  if (serverName.includes('Hardcore')) {
    features.push('Hardcore mode');
    features.push('Shoulder radios unavailable');
    features.push('Limited nickname visibility');
    features.push('Killchat disabled');
  } else {
    features.push('Portable shoulder radios: spawnable and placeable');
    features.push('Nickname rendering up to 300 meters');
    features.push('Killchat fully enabled');
  }
  
  if (serverName.includes('Drones')) {
    features.push('Drones enabled');
  }
  
  return features;
}

// Fallback server data if API fails
function loadFallbackServers() {
  console.log('Loading fallback server data...');
  
  serversData = [
    {
      server_name: "[EU] Conflict in Europe #1 (CIE) | UA-RU War | 1pp/3pp",
      player_count: 128,
      max_players: 128,
      ip: "49.12.148.120",
      port: 21020
    },
    {
      server_name: "[EU] Conflict in Europe #2 (CIE) | UA-RU War | 1pp",
      player_count: 64,
      max_players: 128,
      ip: "49.12.148.120", 
      port: 22020
    },
    {
      server_name: "[EU] Conflict in Europe #3 (CIE) | Drones UA-RU | 1pp/3pp",
      player_count: 100,
      max_players: 128,
      ip: "78.46.90.51",
      port: 23020
    },
    {
      server_name: "[EU] Conflict in Europe #4 (CIE) | Hardcore UA-RU | 1pp",
      player_count: 0,
      max_players: 128,
      ip: "78.46.90.51",
      port: 24020,
      offline: true
    },
    {
      server_name: "[EU] Conflict in Europe #5 (CIE) | Drones UA-RU | 1pp/3pp",
      player_count: 40,
      max_players: 128,
      ip: "49.12.148.120",
      port: 25020
    },
    {
      server_name: "[EU] Conflict in Europe #6 (CIE) | Drones UA-RU | 1pp",
      player_count: 90,
      max_players: 128,
      ip: "78.46.90.51",
      port: 36020
    }
  ];
  
  renderServers();
}

// Function to get server status
function getServerStatus(server, lang = currentLang) {
  if (server.offline) {
    return {
      online: false,
      text: getTranslation('servers.offline', lang)
    };
  }
  
  if (server.player_count !== undefined && server.max_players) {
    return {
      online: true,
      text: getTranslation('servers.online', lang)
    };
  }
  return {
    online: false,
    text: getTranslation('servers.offline', lang)
  };
}

// Function to render servers
function renderServers() {
  const serverList = document.querySelector('.server-list');
  if (!serverList) return;
  
  const lang = currentLang || 'uk'; // Fallback to 'uk' if currentLang is not set
  
  if (serversData.length === 0) {
    serverList.innerHTML = `
      <div class="server-loading">
        ${getTranslation('servers.loading', lang)}
      </div>
    `;
    return;
  }
  
  serverList.innerHTML = serversData.map((server, index) => {
    const status = getServerStatus(server, lang);
    const features = parseServerInfo(server.server_name);
    const cleanName = server.server_name
      .replace(/\s*\|\s*discord\.gg\/[^\s]*/, '') // Remove discord link
      .replace(/\s*\|\s*$/, '') // Remove trailing separator
      .trim();
    
    const ip = server.ip || 'N/A';
    const port = server.port || 'N/A';
    const ipPort = ip !== 'N/A' && port !== 'N/A' ? `${ip}:${port}` : 'N/A';
    
    // Determine region based on IP
    let region = 'EU';
    if (ip.startsWith('49.12')) {
      region = 'DE (Hetzner)';
    } else if (ip.startsWith('78.46')) {
      region = 'DE (Hetzner)';
    }
    
    return `
      <article class="server-card">
        <div class="server-flag" aria-hidden="true">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="2"/></svg>
        </div>

        <div class="server-info">
          <div class="server-name">${cleanName}</div>
          <div class="server-meta">
            <span class="status ${status.online ? '' : 'offline'}">
              <span class="dot"></span>
              <span>${status.text}</span>
            </span>
            <span>
              <span>${getTranslation('servers.players', lang)}</span>: 
              ${server.player_count || 0} / ${server.max_players || 'N/A'}
            </span>
            <span>
              <span>${getTranslation('servers.region', lang)}</span>: 
              ${region}
            </span>
          </div>
          ${ipPort !== 'N/A' ? `<button class="server-ip" data-copy="${ipPort}">${ipPort}</button>` : ''}
          <ul class="server-features">
            ${features.map(feature => `<li>${feature}</li>`).join('')}
          </ul>
        </div>
        <div class="server-cta">
          <a class="btn btn-primary btn-sm" href="#">
            ${getTranslation('servers.join_now', lang)}
          </a>
        </div>
      </article>
    `;
  }).join('');
  
  // Re-attach copy functionality to new IP buttons
  document.querySelectorAll('[data-copy]').forEach(btn => {
    if (!btn.hasAttribute('data-copy-attached')) {
      btn.setAttribute('data-copy-attached', 'true');
      btn.addEventListener('click', () => copyText(btn.getAttribute('data-copy')));
    }
  });
}

// Function to show server loading error
function showServerError() {
  const serverList = document.querySelector('.server-list');
  if (!serverList) return;
  
  serverList.innerHTML = `
    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--danger); display: flex; align-items: center; justify-content: center; gap: 8px;">
      <span>⚠️</span>
      ${getTranslation('servers.error', currentLang)}
    </div>
  `;
}

// Auto-refresh servers every 30 seconds
setInterval(loadServers, 30000);

// QR Modal functionality
const qrModal = document.getElementById('qrModal');
const qrModalImage = document.getElementById('qrModalImage');
const qrModalText = document.getElementById('qrModalText');
const qrModalClose = document.querySelector('.qr-modal-close');

// QR code mappings
const qrCodes = {
  patreon: {
    image: './assets/qr-patreon.png',
    text: {
      uk: 'Скануйте QR код для переходу на Patreon',
      en: 'Scan QR code to go to Patreon'
    }
  },
  paypal: {
    image: './assets/qrp24.png', // Using same image for now
    text: {
      uk: 'Скануйте QR код для переходу на PayPal',
      en: 'Scan QR code to go to PayPal'
    }
  },
  privat24: {
    image: './assets/qrp24.png',
    text: {
      uk: 'Скануйте QR код для оплати через Privat24',
      en: 'Scan QR code to pay via Privat24'
    }
  },
  bep20: {
    image: './assets/qr-bep.png',
    text: {
      uk: 'Скануйте QR код для USDT BEP20 гаманця',
      en: 'Scan QR code for USDT BEP20 wallet'
    }
  },
  trc20: {
    image: './assets/qr-trc.png',
    text: {
      uk: 'Скануйте QR код для USDT TRC20 гаманця',
      en: 'Scan QR code for USDT TRC20 wallet'
    }
  }
};

// Show QR modal
function showQRModal(qrType) {
  const qrData = qrCodes[qrType];
  if (!qrData || !qrModal) return;
  
  qrModalImage.src = qrData.image;
  qrModalImage.alt = getTranslation(`support.qr_${qrType}_alt`, currentLang);
  qrModalText.textContent = qrData.text[currentLang] || qrData.text.en;
  
  qrModal.classList.add('show');
  document.body.style.overflow = 'hidden';
}

// Hide QR modal
function hideQRModal() {
  if (!qrModal) return;
  qrModal.classList.remove('show');
  document.body.style.overflow = '';
}

// Event listeners for QR buttons
document.querySelectorAll('[data-qr]').forEach(btn => {
  btn.addEventListener('click', () => {
    const qrType = btn.getAttribute('data-qr');
    showQRModal(qrType);
  });
});

// Close modal events
if (qrModalClose) {
  qrModalClose.addEventListener('click', hideQRModal);
}

if (qrModal) {
  qrModal.addEventListener('click', (e) => {
    if (e.target === qrModal) {
      hideQRModal();
    }
  });
}

// Close modal on Escape key
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    // Close QR modal
    if (qrModal && qrModal.classList.contains('show')) {
      hideQRModal();
    }
    
    // Close mobile menu
    if (mobileMenu && mobileMenu.classList.contains('open')) {
      mobileMenu.classList.remove('open');
      burger.setAttribute('aria-expanded', 'false');
      burger.setAttribute('aria-label', 'Open menu');
      document.body.style.overflow = '';
    }
  }
});
